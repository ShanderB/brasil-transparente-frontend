<main>
  @if(isLoading){
    <div class="loader-container">
      <div class="loader-spinner"></div>
      <p>Carregando dados...</p>
    </div>
  } @else {
    <div class="total-display">
      <h2>Valor total gasto em 2024:</h2>
      <div
      (mouseenter)="showRawTotal.set(true)"
      (mouseleave)="showRawTotal.set(false)"
      class="total-value">{{ showRawTotal() ? formatCurrency(totalValue) : formatLargeCurrency(totalValue) }}</div>
    </div>

    <div class="full-report">
      @for(poder of poderes; track poder.id) {
        <ng-container *ngTemplateOutlet="recursiveBar; context: { $implicit: poder }"></ng-container>
      }
    </div>
  }
</main>

<ng-template #recursiveBar let-item>
  <app-toggle-bar-item
    [name]="item.name"
    [level]="item.level"
    [totalValueSpent]="item.totalValueSpent"
    [percentageOfTotal]="item.percentageOfTotal"
    [barColor]="getBarColor(item.level)"
    [isLastLevel]="item.level === 4"
    [isExpanded]="item.expanded"
    (toggle)="onTogglePoder(item)"
  >
    @if(item.expanded && item.children) {
      @for(child of item.children; track child.id) {
        <ng-container *ngTemplateOutlet="recursiveBar; context: { $implicit: child }"></ng-container>
      }
    }
  </app-toggle-bar-item>
</ng-template>