<main>
  @if(isLoading()){
  <app-carregando-dados
    [skeletonCount]="poderes.length"
    [activeReport]="ReportType.Completo"
  />
  } @else {
  <div class="total-display">
    <h2>Valor total gasto em 2025:</h2>
    <div
      (mouseenter)="showRawTotal.set(true)"
      (mouseleave)="showRawTotal.set(false)"
      class="total-value"
    >
      {{ showRawTotal() ? formatCurrency(totalValue) : formatLargeCurrency(totalValue) }}
    </div>
  </div>

  <div class="simplified-report">
    <div class="simplified-bars">
      @for(poder of poderes; track poder.id) {
      <ng-container *ngTemplateOutlet="recursiveBar; context: { $implicit: poder }"></ng-container>
      }
    </div>
  </div>
  }
</main>

<ng-template #recursiveBar let-item>
  <app-toggle-bar-item
    [name]="item.name"
    [level]="item.level"
    [totalValueSpent]="item.totalValueSpent"
    [percentageOfTotal]="item.percentageOfTotal"
    [barColor]="getBarColor(item.level)"
    [isLastLevel]="item.level === 4"
    [isBarExpanded]="item.expanded"
    (toggle)="onTogglePoder(item)"
  >
    @if(item.expanded && item.children) { @for(child of item.children; track child.id) {
    <ng-container *ngTemplateOutlet="recursiveBar; context: { $implicit: child }"></ng-container>
    } }
  </app-toggle-bar-item>
</ng-template>
